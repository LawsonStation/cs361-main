<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ item['title'] }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        h1 {
            color: #333;
        }
        .item-details {
            margin: 20px;
        }
    </style>
</head> -->

{% extends 'layouts/base.html' %}

{% block title %}Item Details{% endblock %}

{% block content %}
<header>
    <h1>{{ item['title'] }}</h1>
</header>
<main>
    <body>
        <div class="item-details">
            <p><strong>Title:</strong> {{ item['title'] }}</p>
            <!-- <p><strong>Currency:</strong> {{ item['currency'] }}</p> -->
            <p><strong>Price:</strong> ${{ item['price'] }}</p>
            <p><strong>Description:</strong> {{ item['description'] }}</p>
            <p><strong>City:</strong> {{ item['city'] }}</p>
            <p><strong>State:</strong> {{ item['state'] }}</p>
            <p><strong>Zip Code:</strong> {{ item['zip_code'] }}</p>
            

            <!-- <p><strong>Photo:</strong></p>
            {% if item['photo'] %}
            <p><img src="data:image/jpeg;base64,{{ item['photo'] }}"
                    alt="Item Photo">
            </p>
            {% else %}
            <p>No photo available</p>
            {% endif %} -->

            <p><strong>Photo:</strong></p>
                {% if image_data_base64 %}
                    <img src="data:image/jpeg;base64,{{ image_data_base64 }}" alt="Item Photo">
                {% else %}
                    <p>No photo available</p>
                {% endif %}

            <hr>

            <div class="map-section">
                <p><strong>Location Map:</strong></p>
                {% if map_image_data %}
                <!-- <h2>Map Image</h2> -->
                <img src="data:image/png;base64,{{ map_image_data }}" alt="Map Image">
                {% else %}
                <p>No map image available.</p>
                {% endif %}
                        </div>
            
            <hr> 

            <p><strong>Page Views:</strong> {{ page_count or
                'Unable to fetch count' }}</p>
            
            <hr>
            
            <!-- Currency Conversion -->
                <div class="currency-converter">
                    <h3>Currency Converter</h3>
                    <p>Original Price (USD): $<span id="original-price">{{ item['price'] }}</span></p>
                    <label for="currency-selector">Select Currency:</label>
                    <select id="currency-selector">
                        <option value="">--Select Currency--</option>
                        <option value="EUR">EUR</option>
                        <option value="GBP">GBP</option>
                        <option value="JPY">JPY</option>
                        <option value="AUD">AUD</option>
                        <option value="CAD">CAD</option>
                    </select>
                    <p>Converted Price: <input type="text" id="converted-price" readonly></p>
                    <button id="reset-btn">Reset Currency Converter</button>
                </div>
                
                <script>
                    document.getElementById('currency-selector').addEventListener('change', async function() {
                        const selectedCurrency = this.value;
                        const priceUSD = parseFloat(document.getElementById('original-price').textContent);
                
                        if (!selectedCurrency) {
                            document.getElementById('converted-price').value = '';
                            return;
                        }
                
                        try {
                            const response = await fetch('/convert_currency', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ amount: priceUSD, targetCurrency: selectedCurrency })
                            });
                
                            const result = await response.json();
                            if (response.ok) {
                                document.getElementById('converted-price').value = `${result.convertedAmount} ${result.targetCurrency}`;
                            } else {
                                alert(result.error || 'Error converting currency');
                            }
                        } catch (error) {
                            console.error('Error:', error);
                            alert('An error occurred while fetching the conversion.');
                        }
                    });
                
                    document.getElementById('reset-btn').addEventListener('click', function() {
                        document.getElementById('currency-selector').value = '';
                        document.getElementById('converted-price').value = '';
                    });
                </script>
                
            <br>
            <hr>

            <a href="{{ url_for('browse') }}">Back to Items List</a>
        </div>
        <br>
        <div>
            <!-- Delete button -->
            <form action="{{ url_for('delete_listing', item_id=item['id']) }}"
                method="POST"
                onsubmit="return confirm('Are you sure you want to delete this listing?');">
                <input type="submit" value="Delete Listing"
                    class="btn btn-danger">
            </form>
        </div>
    </body>
</main>

{% endblock %}